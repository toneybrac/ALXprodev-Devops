#!/bin/bash

# Script: data_extraction_automation-0x01
# Description: Extracts PokÃ©mon data from JSON file using only jq, awk, sed

# Check if data.json exists
[ ! -f "data.json" ] && echo "Error: data.json not found" >&2 && exit 1

# Extract data using jq and format using awk and sed
# Using exact format: "Pikachu is of type Electric, weighs 6kg, and is 0.4m tall."

jq -r '
  .name as $name |
  .height as $height |
  .weight as $weight |
  .types[0].type.name as $type |
  "\($name) \($height) \($weight) \($type)"
' data.json 2>/dev/null | \
awk '{
    # Convert height from decimeters to meters
    height_m = $2 / 10
    
    # Convert weight from hectograms to kilograms  
    weight_kg = $3 / 10
    
    # Remove .0 if present
    if (height_m == int(height_m)) height_m = int(height_m)
    if (weight_kg == int(weight_kg)) weight_kg = int(weight_kg)
    
    # Capitalize first letter of name
    name = toupper(substr($1,1,1)) substr($1,2)
    
    # Capitalize first letter of type using sed via system call
    type_cmd = "echo \"" $4 "\" | sed \"s/^./\\U&/\""
    type_cmd | getline type
    close(type_cmd)
    
    # Format the output exactly as required
    printf "%s is of type %s, weighs %skg, and is %sm tall.\n", name, type, weight_kg, height_m
}' || echo "Error: Failed to extract data from data.json" >&2
